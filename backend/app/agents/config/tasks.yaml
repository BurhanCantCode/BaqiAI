analyze_spending:
  description: >
    Analyze the spending data provided below for this user.
    Categorize all transactions into fixed, discretionary, and watery spending.
    Calculate the monthly baqi (investable surplus).
    Identify the top 3 areas where spending can be reduced.

    Spending Analysis Data:
    {spending_data}

    User monthly income: PKR {income}
  expected_output: >
    A JSON object with keys: total_income (float), total_spending (float),
    baqi_amount (float), fixed_pct (float), discretionary_pct (float),
    watery_pct (float), top_reductions (list of 3 strings with specific
    merchant names and PKR amounts that could be saved).
  agent: spending_analyzer

assess_risk:
  description: >
    Based on the user profile below, determine their investment risk profile.

    User age: {age}
    Monthly income: PKR {income}
    Risk quiz answers (1-5 scale): {quiz_answers}
    Risk profile from quiz: {risk_profile}
    Baqi amount available: PKR {baqi_amount}

    Provide specific allocation percentages for equity, fixed income,
    and mutual funds based on the risk profile.
  expected_output: >
    A JSON object with keys: risk_category (conservative/moderate/aggressive),
    risk_score (1-10), equity_pct (float 0-1), fixed_income_pct (float 0-1),
    mutual_fund_pct (float 0-1), rationale (string explaining the assessment).
  agent: risk_profiler

analyze_market:
  description: >
    Analyze the PSX market data provided below for Pakistani investors.
    Use ONLY the data provided — do NOT invent statistics, index values,
    or policy rates not present in the data.

    PSX Stock Data (from BAQI ML Prediction Engine):
    {psx_data}

    This data includes ML-generated 21-day price predictions with confidence scores
    for stocks across 5 sectors (Cement, Fertilizer, Energy, Banking, Technology).
    Stocks with "ml_prediction" fields have real machine-learning forecasts.

    Based on this data:
    - Identify which stocks have positive 21-day predicted returns (profitable)
    - Compare ML prediction confidence scores — prefer high-confidence predictions
    - Note the price-to-earnings ratios to flag overvalued stocks
    - Assess overall market conditions based on the spread of predicted returns
    - Flag risks (e.g. negative predicted returns, low confidence, high PE)
    - Identify opportunities (e.g. stocks with strong positive ML predictions)

    IMPORTANT: Base your analysis ONLY on the data above.
    Do NOT fabricate KSE-100 index values, SBP rates, or inflation figures.
  expected_output: >
    A JSON object with keys: market_outlook (bullish/neutral/bearish),
    analysis_basis (string saying "Based on BAQI Data Engine stock predictions"),
    top_sectors (list of strings ranked by average predicted return),
    risks (list of strings based on actual PE ratios and data),
    opportunities (list of strings citing specific tickers and their predicted returns).
  agent: market_sentiment

screen_halal:
  description: >
    The user has halal_preference = {halal_preference}.
    Screen the following stock tickers for Shariah compliance: {candidate_tickers}.
    Use KMI-30 index components and standard Islamic screening criteria.
    For each ticker, indicate if it is halal and provide brief reasoning.
  expected_output: >
    A JSON object with keys: screened_stocks (list of objects, each with
    ticker, is_halal (bool), reason (string)), compliant_count (int),
    total_screened (int).
  agent: halal_compliance

generate_recommendation:
  description: >
    Based on all the analysis below, construct a specific investment portfolio
    for this Pakistani customer.

    Available amount: PKR {baqi_amount}
    Risk profile: {risk_profile} (equity {equity_pct}%, fixed_income {fixed_income_pct}%, mutual_fund {mutual_fund_pct}%)
    Halal preference: {halal_preference}
    Market outlook: {market_outlook}
    Top sectors: {top_sectors}
    PSX stock predictions (ML-powered): {psx_predictions}
    Halal screened stocks: {halal_stocks}

    Construct a portfolio with 4-6 specific allocations.
    PRIORITIZE stocks with positive ML-predicted 21-day returns.
    Only recommend stocks where the ML model predicts profitable returns.
    CRITICAL: You MUST only use tickers that appear in the PSX stock predictions
    or halal screened stocks data above. Do NOT invent ticker symbols.
    Valid stock tickers include: LUCK, SYS, ENGRO, FFC, OGDC, PPL, MARI, SEARL, TRG, EFERT, FCCL, MEBL, UBL, HBL, DGKC, HUBC, PSO, NESTLE, COLG, UNITY.
    Valid mutual fund tickers include: ALMEEZAN_EQUITY, NBP_STOCK, HBL_ISLAMIC, ALMEEZAN_INCOME, NBP_INCOME.
    Each allocation must have: asset_name, ticker (from the list above), asset_type (stock/mutual_fund/fixed_income),
    amount_pkr, percentage, expected_return (annual, from the provided data), is_halal, and rationale.
    Include a one-paragraph summary explaining the overall strategy.
  expected_output: >
    A JSON object with keys: portfolio (list of allocation objects),
    total_invested (float), expected_annual_return (float),
    summary (string with 2-3 sentences).
  agent: investment_agent
